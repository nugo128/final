const data = [
  {
    monday: [
      {
        id: 1,
        start: 10,
        end: 20,
        title: "ურჩხული და ლამაზმანი",
        cover:
          "https://tkt-static.lemon.do/img/5161dbdb-0050-48f4-b7f2-4c21c8a7ba36.jpeg",
      },
      {
        id: 2,
        start: 10,
        end: 20,
        title: "მერე რა რომ, სველია სველი იასამანი",
        cover:
          "https://tkt-static.lemon.do/img/0f40afe7-396d-4158-8526-0b56b0c6b255.jpeg",
      },
      {
        id: 3,
        start: 10,
        end: 20,
        title: "შეყრა",
        cover:
          "https://tkt-static.lemon.do/img/68eaefd8-2a61-48bc-a0ce-7261aab14bc8.jpeg",
      },
    ],
    tuesday: [
      {
        id: 4,
        start: 10,
        end: 20,
        title: "მე, ბებია, ბაბუა და ჭინკები",
        cover:
          "https://tkt-static.lemon.do/img/410c4b0e-d63a-46c3-bb74-d3a03f753853.jpeg",
      },
      {
        id: 5,
        start: 10,
        end: 20,
        title: "ყვავილები ელჯერნონისთვის",
        cover:
          "https://tkt-static.lemon.do/img/053b9bdf-604e-4080-9b31-07d56e830f6d.jpeg",
      },
      {
        id: 6,
        start: 10,
        end: 20,
        title: "ფრთხილად ადამსები!",
        cover:
          "https://tkt-static.lemon.do/img/1db992f5-1d32-4dd7-a6a0-3bc668910b21.jpeg",
      },
    ],
    wednesday: [
      {
        id: 7,
        start: 10,
        end: 20,
        title: "სხვების ცხოვრება",
        cover:
          "https://tkt-static.lemon.do/img/01596ec6-7ef8-41dc-84a6-3adb84545d60.jpeg",
      },
      {
        id: 8,
        start: 10,
        end: 20,
        title: "რამონა",
        cover:
          "https://tkt-static.lemon.do/img/52247154-7cb1-495f-979c-013e2730e59c.jpeg",
      },
      {
        id: 9,
        start: 10,
        end: 20,
        title: "კომედიანტები",
        cover:
          "https://tkt-static.lemon.do/img/c0e68ee5-b119-476e-81f1-1bb33589e776.jpeg",
      },
    ],
    thursday: [
      {
        id: 10,
        start: 10,
        end: 20,
        title: "ჩემი გაზაფხულის შემოდგომა",
        cover:
          "https://tkt-static.lemon.do/img/94b6b77e-ca60-4b1a-b24a-3eb26092403d.jpeg",
      },
      {
        id: 11,
        start: 10,
        end: 20,
        title: "ანუ მე შენ მიყვარხარ",
        cover:
          "https://tkt-static.lemon.do/img/c19054cd-fa85-4924-9895-0ff6597dbfb5.jpeg",
      },
      {
        id: 12,
        start: 10,
        end: 20,
        title: "მოხუცი და ზღვა",
        cover:
          "https://tkt-static.lemon.do/img/2b4be8eb-c6be-4ef7-b4fb-c3933a45f123.jpeg",
      },
    ],
    friday: [
      {
        id: 13,
        start: 10,
        end: 20,
        title: "ყველაზე მაგარი გოგოები",
        cover:
          "https://tkt-static.lemon.do/img/a81df611-4dbd-4a91-8002-83abaeadd65d.jpeg",
      },
      {
        id: 14,
        start: 10,
        end: 20,
        title: "ალადინი",
        cover:
          "https://tkt-static.lemon.do/img/0d97441c-8656-49cf-bc49-f0c951a9e39b.jpeg",
      },
      {
        id: 15,
        start: 10,
        end: 20,
        title: "ურჩხული და ლამაზმანი",
        cover:
          "https://tkt-static.lemon.do/img/5161dbdb-0050-48f4-b7f2-4c21c8a7ba36.jpeg",
      },
    ],
    saturday: [
      {
        id: 16,
        start: 12,
        end: 22,
        title: "წითელქუდა",
        cover:
          "https://tkt-static.lemon.do/img/9a0ced6e-329b-4b6b-951e-1748c8621ee2.jpeg",
      },
      {
        id: 17,
        start: 12,
        end: 22,
        title: "გაყრა",
        cover:
          "https://tkt-static.lemon.do/img/b6e3f2c1-9cce-4fd4-8d42-4e71ffafb1a1.jpeg",
      },
      {
        id: 18,
        start: 12,
        end: 22,
        title: "ზღაპარი იგი მათრობს და მხიბლავს",
        cover:
          "https://tkt-static.lemon.do/img/f35816df-43b2-43ce-a844-3c89f82c439f.jpeg",
      },
    ],
    sunday: [
      {
        id: 19,
        start: 12,
        end: 22,
        title: "ცილინდრი",
        cover:
          "https://tkt-static.lemon.do/img/82c2e9e4-4ef7-4fe5-a8c9-008425babdf9.jpeg",
      },
      {
        id: 20,
        start: 12,
        end: 22,
        title: "შვლის ნუკრის ნაამბობი",
        cover:
          "https://tkt-static.lemon.do/img/f7ea467f-b4b4-42f8-9a0a-9fd0e9f7618f.jpeg",
      },
      {
        id: 21,
        start: 12,
        end: 22,
        title: "წითელი ფეხსაცმელები",
        cover:
          "https://tkt-static.lemon.do/img/228702ef-7486-4160-8b3e-d1dd60e50993.jpeg",
      },
    ],
  },
];
const selectedDate = document.getElementById("selectdate");
const itemsCont = document.getElementById("allitems");
const maindiv1 = document.createElement("div");
const maindiv2 = document.createElement("div");
const maindiv3 = document.createElement("div");
const maindiv4 = document.createElement("div");
const maindiv5 = document.createElement("div");
const maindiv6 = document.createElement("div");
const maindiv7 = document.createElement("div");
maindiv1.className = "main1 monday";
maindiv2.className = "main2 tuesday";
maindiv3.className = "main3 wednesday";
maindiv4.className = "main4 thursday";
maindiv5.className = "main5 friday";
maindiv6.className = "main6 saturday";
maindiv7.className = "main7 sunday";
const maindivs = [
  maindiv1,
  maindiv2,
  maindiv3,
  maindiv4,
  maindiv5,
  maindiv6,
  maindiv7,
];
const weekDays = [
  data[0].monday,
  data[0].tuesday,
  data[0].wednesday,
  data[0].thursday,
  data[0].friday,
  data[0].saturday,
  data[0].sunday,
];

//გამომაქვს ყველა სპეკტაკლის მომაცემები
for (let i = 0; i < weekDays.length; i++) {
  weekDays[i].map((info, index) => {
    const div = document.createElement("div");
    div.className = `div${index}`;
    const img = document.createElement("img");
    img.src = info.cover;
    img.className = "img1";
    div.appendChild(img);
    const title = document.createElement("h2");
    title.textContent = info.title;
    title.className = "title";
    div.appendChild(title);
    const time = document.createElement("select");
    time.className = "time";
    div.appendChild(time);
    for (let j = info.start; j < info.end; j += 2) {
      let a = document.createElement("option");
      a.value = `${j}:00-${j + 2}:00`;
      a.textContent = `${j}:00-${j + 2}:00`;
      a.className = `timeselect${j}${i}${index}`;
      time.appendChild(a);
    }
    const btn = document.createElement("button");
    btn.textContent = "book";
    btn.className = "btn";
    div.appendChild(btn);
    maindivs[i].appendChild(div);
    itemsCont.appendChild(maindivs[i]);
  });
}

const timee = document.querySelectorAll(".time");
const btnn = document.querySelectorAll(".btn");
const img1 = document.querySelectorAll(".img1");
const titlee = document.querySelectorAll(".title");
const timeselect = document.querySelectorAll(".timeselect");

//დაჯავშნის ღილაკის დაჭერაზე localstorage-ში მიმაქვს ყველა საჭირო ინფო.
for (let i = 0; i < btnn.length; i++) {
  btnn[i].addEventListener("click", () => {
    localStorage.setItem(
      `booking${i}-${timee[i].value}`,
      [
        timee[i].value,
        selectedDate.value,
        img1[i].src,
        titlee[i].textContent,
      ].join(" ")
    );
  });
}

//თავიდან, ვაფერადებ ყველა დროის ასარჩევს მწვანედ
const allOptions = document.querySelectorAll("option");
for (let i = 7; i < allOptions.length; i++) {
  allOptions[i].style.color = "green";
}
const booked = document.querySelector(".booked-playes");
let values = [];

// allStorage ფუნქციით localstorage-დან მომაქვს ინფო, შემდეგ დაჯავშნილი სპეკტაკლები გამომაქვს ეკრანზე და ასევე დაჯავშნილ დროებს ვუცვლი ფერს
function allStorage() {
  //მომაქვს ლოკალიდან
  let keys = Object.keys(localStorage),
    i = keys.length;

  while (i--) {
    values.push(localStorage.getItem(keys[i]));
  }
  function onlyUnique(value, index, self) {
    return self.indexOf(value) === index;
  }

  let unique = values.filter(onlyUnique);
  //გამომაქვს ეკრანზე
  unique.map((data, index) => {
    const splitted = data.split(" ");
    const div = document.createElement("div");
    div.className = `bookeddiv`;
    const img = document.createElement("img");
    const weekDay = document.createElement("h2");
    weekDay.className = "bookedweekday";
    weekDay.textContent = splitted[1];
    img.className = "img1";
    img.src = splitted[2];
    const title = document.createElement("h2");
    title.className = "bookedtitle";
    for (let i = 3; i < splitted.length; i++) {
      title.textContent += ` ${splitted[i]}`;
    }
    const time = document.createElement("h2");
    time.className = "bookedtime";
    time.textContent = splitted[0];
    div.style.display = "flex";
    div.appendChild(img);
    div.appendChild(title);
    div.appendChild(weekDay);
    div.appendChild(time);
    booked.appendChild(div);
    //ფერს ვუცვლი
    for (let j = 0; j < btnn.length; j++) {
      if (
        " " + titlee[j].textContent === title.textContent &&
        img.src === img1[j].src &&
        selectedDate.value === weekDay.textContent
      ) {
        for (let i = 7; i < allOptions.length; i++) {
          if (selectedDate.value === "monday" && i >= 7 && i < 22) {
            if (j === 0 && i >= 7 && i < 12) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 1 && i >= 12 && i < 17) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 2 && i >= 17 && i < 22) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
          }
          if (selectedDate.value === "tuesday" && i >= 22 && i < 37) {
            if (j === 3 && i >= 22 && i < 27) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 4 && i >= 27 && i < 32) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 5 && i >= 32 && i < 37) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
          }
          if (selectedDate.value === "wednesday" && i >= 37 && i < 52) {
            if (j === 6 && i >= 37 && i < 42) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 7 && i >= 42 && i < 47) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 8 && i >= 47 && i < 52) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
          }
          if (selectedDate.value === "thursday" && i >= 52 && i < 67) {
            if (j === 9 && i >= 52 && i < 57) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 10 && i >= 57 && i < 62) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 11 && i >= 62 && i < 67) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
          }
          if (selectedDate.value === "friday" && i >= 67 && i < 82) {
            if (j === 12 && i >= 67 && i < 72) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 13 && i >= 72 && i < 77) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 14 && i >= 77 && i < 82) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
          }
          if (selectedDate.value === "saturday" && i >= 82 && i < 97) {
            if (j === 15 && i >= 82 && i < 87) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 16 && i >= 87 && i < 92) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 17 && i >= 92 && i < 97) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
          }
          if (selectedDate.value === "sunday" && i >= 97 && i < 112) {
            if (j === 18 && i >= 97 && i < 102) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 19 && i >= 102 && i < 107) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
            if (j === 20 && i >= 107 && i < 112) {
              if (allOptions[i].value === time.textContent) {
                allOptions[i].style.color = "red";
              }
            }
          }
        }
      }
    }
  });
}
allStorage();
for (let i = 0; i < btnn.length; i++) {
  btnn[i].addEventListener("click", () => {
    const bkeddiv = document.querySelectorAll(".bookeddiv");
    for (let i = 0; i < bkeddiv.length; i++) {
      bkeddiv[i].style.display = "none";
    }
    allStorage();
  });
}
//გამომაქვს სპეკტაკლები დღეების მიხედვით
selectedDate.addEventListener("change", () => {
  for (let i = 1; i <= 7; i++) {
    if (
      !document
        .querySelector(`.main${i}`)
        .classList.contains(selectedDate.value)
    ) {
      document.querySelector(`.main${i}`).style.display = "none";
    } else {
      document.querySelector(`.main${i}`).style.display = "grid";
    }
  }
  for (let i = 100; i <= 202; i++) {
    if (document.querySelector(`.timeselect${i}`)) {
      console.log(`.timeselect${i}`);
    }
  }

  const bkeddiv = document.querySelectorAll(".bookeddiv");
  for (let i = 0; i < bkeddiv.length; i++) {
    bkeddiv[i].style.display = "none";
  }
  allStorage();
});

//გასუფთავების ღილაკი
const deleteBooks = document.querySelector(".deletebooks");
deleteBooks.addEventListener("click", function () {
  localStorage.clear();
  document.location.reload();
});
